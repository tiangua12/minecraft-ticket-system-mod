<!doctype html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ç«è½¦ç¥¨åŠ¡ç³»ç»ŸÂ·æ§åˆ¶å°</title>
  <link rel="stylesheet" href="style.css" />
  <style>
    /* ä¸»é¢˜åˆ‡æ¢æŒ‰é’® */
    .theme-toggle {
      position: absolute;
      top: 24px;
      right: 24px;
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: 10px 16px;
      color: var(--text);
      cursor: pointer;
      font-weight: 700;
      display: flex;
      align-items: center;
      gap: 8px;
      transition: all 0.2s ease;
      z-index: 10;
    }

    .theme-toggle:hover {
      background: var(--card);
    }

    .theme-icon {
      font-size: 18px;
    }

    /* è¿”å›æŒ‰é’®æ ·å¼è°ƒæ•´ */
    .site-header {
      position: relative;
    }

    /* ç¥¨åŠ¡ç®¡ç†å­æ ‡ç­¾é¡µ */
    .sub-tabs {
      display: flex;
      gap: 8px;
      margin-bottom: 20px;
      border-bottom: 1px solid var(--border);
      padding-bottom: 8px;
    }

    .sub-tab {
      background: transparent;
      color: var(--muted);
      border: none;
      border-radius: 6px;
      padding: 8px 16px;
      font-weight: 700;
      cursor: pointer;
      transition: all 0.2s ease;
    }

    .sub-tab:hover {
      color: var(--text);
    }

    .sub-tab.active {
      color: var(--text);
      background: var(--surface);
      border: 1px solid var(--border);
    }

    .sub-view {
      display: none;
    }

    .sub-view.active {
      display: block;
    }

    /* è½¦ç¥¨è®¡ç®—å™¨ */
    .ticket-calculator {
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: 14px;
      padding: 24px;
      margin-bottom: 24px;
    }

    .ticket-calculator .form-row {
      display: flex;
      gap: 16px;
      margin-bottom: 16px;
      align-items: flex-end;
    }

    .ticket-calculator .form-group {
      flex: 1;
    }

    .ticket-calculator label {
      display: block;
      margin-bottom: 8px;
      color: var(--muted);
      font-weight: 700;
    }

    .ticket-calculator select,
    .ticket-calculator input {
      width: 100%;
      padding: 12px;
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: 8px;
      color: var(--text);
      font-size: 14px;
    }

    .ticket-calculator button {
      padding: 12px 24px;
      background: var(--accent);
      color: white;
      border: none;
      border-radius: 8px;
      font-weight: 700;
      cursor: pointer;
    }

    .ticket-calculator button:hover {
      background: var(--accent-soft);
    }

    .ticket-preview {
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: 14px;
      padding: 24px;
      margin-top: 24px;
    }

    .ticket-preview canvas {
      max-width: 100%;
      border-radius: 8px;
      background: white;
    }

    .export-actions {
      display: flex;
      gap: 12px;
      margin-top: 16px;
    }

    /* çº¿è·¯ç¼–è¾‘å™¨ */
    .line-toolbar {
      display: flex;
      gap: 12px;
      margin-bottom: 20px;
      flex-wrap: wrap;
      align-items: center;
    }

    .line-toolbar input {
      padding: 10px 14px;
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: 8px;
      color: var(--text);
      font-size: 14px;
      min-width: 120px;
    }

    .line-toolbar button {
      padding: 10px 20px;
      background: var(--accent);
      color: white;
      border: none;
      border-radius: 8px;
      font-weight: 700;
      cursor: pointer;
    }

    .line-toolbar button.btn-secondary {
      background: var(--surface);
      color: var(--text);
      border: 1px solid var(--border);
    }

    .line-toolbar button:hover {
      background: var(--accent-soft);
    }

    .line-toolbar button.btn-secondary:hover {
      background: var(--card);
    }

    .line-editor {
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: 14px;
      padding: 24px;
      min-height: 400px;
      overflow: auto;
    }

    /* ç¥¨ä»·å›¾æ ·å¼ï¼ˆé¢„ç•™ï¼‰ */
    .fare-chart-container {
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: 14px;
      padding: 24px;
      margin-bottom: 24px;
    }

    .fare-chart-toolbar {
      display: flex;
      gap: 12px;
      margin-bottom: 20px;
      flex-wrap: wrap;
    }

    .fare-chart-view {
      display: none;
    }

    .fare-chart-view.active {
      display: block;
    }

    .fare-table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 16px;
    }

    .fare-table th,
    .fare-table td {
      border: 1px solid var(--border);
      padding: 8px 12px;
      text-align: center;
    }

    .fare-table th {
      background: var(--surface);
      font-weight: 700;
    }
  </style>
</head>
<body>
  <header class="site-header">
    <div class="title" style="display: flex; align-items: center; gap: 16px;">
      <button onclick="window.location.href='index.html'" style="padding: 8px 16px; background: var(--accent); color: white; border: none; border-radius: 6px; cursor: pointer; font-size: 14px; font-weight: 700;">è¿”å›ä¸»ç•Œé¢</button>
      <span>ç«è½¦ç¥¨åŠ¡ç³»ç»ŸÂ·æ§åˆ¶å°</span>
    </div>
    <nav class="tabs">
      <button class="tab active" data-tab="dashboard">ä»ªè¡¨ç›˜</button>
      <button class="tab" data-tab="ticket">ç¥¨åŠ¡ç®¡ç†</button>
      <button class="tab" data-tab="settings">ç³»ç»Ÿè®¾ç½®</button>
    </nav>
    <button id="themeToggle" class="theme-toggle">
      <span class="theme-icon">ğŸŒ™</span>
      <span id="themeLabel">æ·±è‰²æ¨¡å¼</span>
    </button>
  </header>

  <main>
    <section id="view-dashboard" class="view active">
      <div class="metrics">
        <div class="metric-card">
          <div class="metric-title">è½¦ç«™æ•°é‡</div>
          <div class="metric-value" id="stationCount">0</div>
        </div>
        <div class="metric-card">
          <div class="metric-title">çº¿è·¯æ•°é‡</div>
          <div class="metric-value" id="lineCount">0</div>
        </div>
      </div>
      <div class="hero"></div>
    </section>

    <section id="view-ticket" class="view">
      <div class="section-title">
        <span>ç¥¨åŠ¡ç®¡ç†</span>
        <span class="hint">çº¿è·¯ç¼–è¾‘ã€è½¦ç¥¨è®¡ç®—ä¸å¯¼å‡ºåŠŸèƒ½</span>
      </div>

      <!-- å­æ ‡ç­¾é¡µå¯¼èˆª -->
      <div class="sub-tabs">
        <button class="sub-tab active" data-subtab="line-editor">çº¿è·¯ç¼–è¾‘</button>
        <button class="sub-tab" data-subtab="ticket-calculator">è½¦ç¥¨è®¡ç®—</button>
        <button class="sub-tab" data-subtab="ticket-export">è½¦ç¥¨å¯¼å‡º</button>
        <button class="sub-tab" data-subtab="fare-chart">ç¥¨ä»·å›¾</button>
      </div>

      <!-- çº¿è·¯ç¼–è¾‘å­è§†å›¾ -->
      <div id="subview-line-editor" class="sub-view active">
        <div class="section-title" style="font-size: 18px; margin-bottom: 16px;">
          <span>çº¿è·¯ç¼–è¾‘å™¨</span>
          <span class="hint">å·¦é”®åœ¨çº¿è·¯ä¸Šåˆ›å»ºè½¦ç«™ï¼Œç‚¹å‡»åŒºé—´è°ƒæ•´åŒºé—´ç¥¨ä»·</span>
        </div>
        <div class="line-toolbar">
          <input id="newLineId" type="text" placeholder="ä¾‹å¦‚ L1" />
          <input id="newLineColor" type="text" placeholder="#3366CC æˆ– orangeï¼ˆæ”¯æŒHEXæˆ–åç§°ï¼‰" />
          <button id="createLineBtn">æ–°å»ºçº¿è·¯</button>
          <button id="recalculateFaresBtn" class="btn-secondary">é‡æ–°è®¡ç®—ç¥¨ä»·</button>
        </div>
        <div id="lineEditor" class="line-editor"></div>
      </div>

      <!-- è½¦ç¥¨è®¡ç®—å­è§†å›¾ -->
      <div id="subview-ticket-calculator" class="sub-view">
        <div class="ticket-calculator">
          <div class="section-title" style="font-size: 18px; margin-bottom: 20px;">
            <span>è½¦ç¥¨è®¡ç®—å™¨</span>
            <span class="hint">é€‰æ‹©èµ·ç‚¹å’Œç»ˆç‚¹ç«™è®¡ç®—ç¥¨ä»·</span>
          </div>

          <div class="form-row">
            <div class="form-group">
              <label for="startStation">èµ·ç‚¹ç«™</label>
              <select id="startStation">
                <option value="">è¯·é€‰æ‹©èµ·ç‚¹ç«™</option>
                <!-- è½¦ç«™é€‰é¡¹å°†é€šè¿‡JavaScriptåŠ¨æ€åŠ è½½ -->
              </select>
            </div>
            <div class="form-group">
              <label for="endStation">ç»ˆç‚¹ç«™</label>
              <select id="endStation">
                <option value="">è¯·é€‰æ‹©ç»ˆç‚¹ç«™</option>
                <!-- è½¦ç«™é€‰é¡¹å°†é€šè¿‡JavaScriptåŠ¨æ€åŠ è½½ -->
              </select>
            </div>
            <div class="form-group" style="flex: 0 0 auto;">
              <button id="calculateTicketBtn">è®¡ç®—ç¥¨ä»·</button>
            </div>
          </div>

          <div id="ticketResult" style="display: none;">
            <div style="background: var(--surface); border-radius: 12px; padding: 20px; margin-top: 20px;">
              <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px;">
                <h3 style="margin: 0; color: var(--text);">è½¦ç¥¨è¯¦æƒ…</h3>
                <span id="ticketPrice" style="font-size: 32px; font-weight: 900; color: var(--accent);">0.00</span>
              </div>
              <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px;">
                <div>
                  <div style="color: var(--muted); font-size: 12px;">èµ·ç‚¹ç«™</div>
                  <div id="ticketStartStation" style="font-weight: 700; color: var(--text);">-</div>
                </div>
                <div>
                  <div style="color: var(--muted); font-size: 12px;">ç»ˆç‚¹ç«™</div>
                  <div id="ticketEndStation" style="font-weight: 700; color: var(--text);">-</div>
                </div>
                <div>
                  <div style="color: var(--muted); font-size: 12px;">è·ç¦»</div>
                  <div id="ticketDistance" style="font-weight: 700; color: var(--text);">-</div>
                </div>
                <div>
                  <div style="color: var(--muted); font-size: 12px;">ç¥¨ä»·ç±»å‹</div>
                  <div id="ticketFareType" style="font-weight: 700; color: var(--text);">æ™®é€šç¥¨</div>
                </div>
              </div>
              <div style="margin-top: 16px; padding-top: 16px; border-top: 1px solid var(--border);">
                <div style="color: var(--muted); font-size: 12px;">ç¥¨å·</div>
                <div id="ticketNumber" style="font-family: monospace; font-weight: 700; color: var(--text);">TICKET-000000</div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- è½¦ç¥¨å¯¼å‡ºäºè§†å›¾ -->
      <div id="subview-ticket-export" class="sub-view">
        <div class="ticket-calculator">
          <div class="section-title" style="font-size: 18px; margin-bottom: 20px;">
            <span>è½¦ç¥¨å¯¼å‡º</span>
            <span class="hint">ç”Ÿæˆå¹¶å¯¼å‡ºè½¦ç¥¨å›¾ç‰‡</span>
          </div>

          <div class="ticket-preview">
            <div style="margin-bottom: 20px;">
              <div style="color: var(--muted); font-size: 12px;">è½¦ç¥¨é¢„è§ˆ</div>
              <canvas id="ticketCanvas" width="800" height="400"></canvas>
            </div>

            <div class="export-actions">
              <button id="generateTicketBtn">ç”Ÿæˆè½¦ç¥¨</button>
              <button id="downloadTicketBtn" disabled>ä¸‹è½½PNG</button>
              <button id="printTicketBtn" disabled>æ‰“å°</button>
            </div>

            <div style="margin-top: 24px; color: var(--muted); font-size: 14px;">
              <div>æç¤ºï¼š</div>
              <ul style="margin: 8px 0; padding-left: 20px;">
                <li>é¦–å…ˆä½¿ç”¨"è½¦ç¥¨è®¡ç®—å™¨"è®¡ç®—ç¥¨ä»·å¹¶ç”Ÿæˆè½¦ç¥¨è¯¦æƒ…</li>
                <li>ç‚¹å‡»"ç”Ÿæˆè½¦ç¥¨"æŒ‰é’®åˆ›å»ºè½¦ç¥¨å›¾ç‰‡é¢„è§ˆ</li>
                <li>ç‚¹å‡»"ä¸‹è½½PNG"ä¿å­˜è½¦ç¥¨å›¾ç‰‡æ–‡ä»¶</li>
                <li>ç‚¹å‡»"æ‰“å°"ä½¿ç”¨æµè§ˆå™¨æ‰“å°åŠŸèƒ½æ‰“å°è½¦ç¥¨</li>
              </ul>
            </div>
          </div>
        </div>
      </div>

      <!-- ç¥¨ä»·å›¾å­è§†å›¾ -->
      <div id="subview-fare-chart" class="sub-view">
        <div class="fare-chart-container">
          <div class="section-title" style="font-size: 18px; margin-bottom: 20px;">
            <span>ç¥¨ä»·å›¾</span>
            <span class="hint">æŸ¥çœ‹æ‰€æœ‰è½¦ç«™é—´çš„ç¥¨ä»·è¡¨ï¼Œæ”¯æŒå¯¼å‡º</span>
          </div>

          <div class="fare-chart-toolbar">
            <button id="showRegularChart" class="sub-tab active" data-chart="regular">æ™®é€šç¥¨ä»·</button>
            <button id="showExpressChart" class="sub-tab" data-chart="express">ç‰¹æ€¥ç¥¨ä»·</button>
            <button id="exportChartPng" class="btn-secondary">å¯¼å‡ºPNG</button>
            <button id="exportChartExcel" class="btn-secondary">å¯¼å‡ºExcel</button>
            <button id="refreshFareChart" class="btn-secondary">åˆ·æ–°æ•°æ®</button>
          </div>

          <div id="fare-chart-regular" class="fare-chart-view active">
            <div style="margin-bottom: 16px; color: var(--muted);">
              æ™®é€šç¥¨ä»·è¡¨ï¼ˆå•ä½ï¼šé“œå¸ï¼‰
            </div>
            <div id="regular-fare-table-container" style="overflow: auto; max-height: 500px;">
              <!-- æ™®é€šç¥¨ä»·è¡¨å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
              <div style="text-align: center; padding: 40px; color: var(--muted);">
                åŠ è½½ç¥¨ä»·æ•°æ®ä¸­...
              </div>
            </div>
          </div>

          <div id="fare-chart-express" class="fare-chart-view">
            <div style="margin-bottom: 16px; color: var(--muted);">
              ç‰¹æ€¥ç¥¨ä»·è¡¨ï¼ˆå•ä½ï¼šé“œå¸ï¼‰
            </div>
            <div id="express-fare-table-container" style="overflow: auto; max-height: 500px;">
              <!-- ç‰¹æ€¥ç¥¨ä»·è¡¨å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
              <div style="text-align: center; padding: 40px; color: var(--muted);">
                å½“å‰ç³»ç»Ÿä»…æ”¯æŒæ™®é€šç¥¨ä»·
              </div>
            </div>
          </div>

          <div style="margin-top: 24px; color: var(--muted); font-size: 14px;">
            <div>ä½¿ç”¨è¯´æ˜ï¼š</div>
            <ul style="margin: 8px 0; padding-left: 20px;">
              <li>ç‚¹å‡»"æ™®é€šç¥¨ä»·"æˆ–"ç‰¹æ€¥ç¥¨ä»·"åˆ‡æ¢æŸ¥çœ‹ä¸åŒç¥¨ä»·è¡¨</li>
              <li>ç‚¹å‡»"å¯¼å‡ºPNG"å°†ç¥¨ä»·è¡¨ä¿å­˜ä¸ºå›¾ç‰‡</li>
              <li>ç‚¹å‡»"å¯¼å‡ºExcel"å°†ç¥¨ä»·è¡¨å¯¼å‡ºä¸ºCSVæ–‡ä»¶</li>
              <li>ç‚¹å‡»"åˆ·æ–°æ•°æ®"é‡æ–°åŠ è½½æœ€æ–°ç¥¨ä»·ä¿¡æ¯</li>
            </ul>
          </div>
        </div>
      </div>
    </section>

    <section id="view-settings" class="view">
      <div class="settings-grid">
        <div class="setting-card">
          <div class="setting-title">APIåœ°å€</div>
          <div class="row">
            <input id="apiBaseInput" type="text" placeholder="http://192.140.163.241:23333/api" />
            <button id="saveApiBaseBtn">ä¿å­˜</button>
          </div>
          <div class="muted">ä¿®æ”¹åå‰ç«¯ä¼šä½¿ç”¨æ–°çš„APIåœ°å€ã€‚</div>
        </div>
        <div class="setting-card">
          <div class="setting-title">æ•°æ®å¯¼å…¥/å¯¼å‡º</div>
          <div class="row">
            <button id="exportBtn">å¯¼å‡ºJSON</button>
            <label class="file-btn">å¯¼å…¥JSON<input id="importFile" type="file" accept="application/json" hidden /></label>
          </div>
          <div class="muted">å¯åœ¨æ­¤å¤‡ä»½æˆ–æ¢å¤ç³»ç»Ÿæ•°æ®ã€‚</div>
        </div>
        <div class="setting-card">
          <div class="setting-title">å±é™©æ“ä½œ</div>
          <button id="resetDataBtn" class="danger">æ¸…ç©ºå…¨éƒ¨æ•°æ®</button>
          <div class="muted">å°†æ¸…ç©ºç«™ç‚¹ã€çº¿è·¯ä¸ç¥¨ä»·ã€‚</div>
        </div>
      </div>
    </section>
  </main>

  <footer class="site-footer">
    <div>åç«¯è¿è¡Œåœ¨ <code>/api</code> Â· æ•°æ®ä¿å­˜åœ¨ <code>web/data/*.json</code></div>
  </footer>

  <script src="theme.js"></script>
  <script src="console.js"></script>
</body>
</html>